var FabModule=(function(a){a.CartBase=function(c,b){this.fabBase=b;this.params=c||{}};a.CartBase.method("init",function(){var c=this,d=c.fabBase.params.pg;c.giftAnOrderModalBox();$("img[name='seal']").attr("height","57");$("#btNvsIcons").show();if("web_cart_confirm_order"==d){c.giftAnOrderDefMsgDefault=$("#giftAnOrderDefMsg").val();c.giftAnOrderCusMsgDefault=$("#giftAnOrderCusMsg").val(),c.checkGiftDetails();$("#orderAsGiftYes").live("click",function(){$(this).hide();$("#giftAnOrderInnerFrms, #giftSaveCanButton").show()});$(".giftAnOrderCanBut").live("click",function(){var h=$("#giftAnOrderDefMsg"),l=$("#giftAnOrderCusMsg"),n=h.val(),m=l.val();var j=c.giftAnOrderDefMsgDefault,k=c.giftAnOrderCusMsgDefault;$(".errorMsgWrapper").hide();$("#gift_to_whome_email, #gift_to_whome_first_name").val("").removeAttr("error").removeClass("fabError");if(n!=j){h.val(j)}if(m!=k){l.val(k)}if($("#gift_note_true_false").is(":checked")){$("#gift_note_true_false").attr("checked",false);$("#giftAnOrderCusMsg").hide();$("#giftAnOrderCusMsgClimit").toggleClass("hide")}$(".editSuccess").hide();if($("#giftAnOrderInnerFrms").hasClass("giftAnOrderInnerFrmsShow")){$("#giftAnOrderInnerFrms").removeClass("giftAnOrderInnerFrmsShow")}else{$("#giftAnOrderInnerFrms").hide()}$("#orderAsGiftYes").show();c.cancelShoppingCartGiftDetails()});$("#editGiftOrder").live("click",function(h){$(".editSuccess").hide();$(".editSuccess").next("#giftAnOrderInnerFrms").addClass("giftAnOrderInnerFrmsShow");$("#giftSaveCanButton").show();h.preventDefault()});$("#addShippingAddress").click(function(){c.addEditShipBillInfo("ship")});$("#addBillingAddress").click(function(){c.addEditShipBillInfo("bill")});$("#changeShippingAddress").click(function(){c.listShipBillInfo("ship")});$("#changeBillingAddress").click(function(){c.listShipBillInfo("bill")});$(".addressTagGrayButton").live("click",function(){c.changeShippingInfo(this)});$("#gift_note_true_false").click(function(){$("#giftAnOrderCusMsg").toggle(this.checked);$("#giftAnOrderCusMsgClimit").toggleClass("hide");$("#giftAnOrderCusMsg").removeClass("fabError");$(".errorMsgWrapper").hide()});$("#giftAnOrderCusMsg").keypress(function(h){if(h.keyCode==13){h.preventDefault()}});$(".col2").height($(".col1").height());$(".placeYourOrder").click(function(){var h=$("#btTransactionForm");if(h.length>0){h.submit()}else{var j=($(".billingInfo #addBillingAddress")[0]?"Please enter billing information.":($(".shippingInfo #addShippingAddress")[0]?"Please add shipping address.":""));$("#errMsgOrder").find(".errorMessage").text(j).parent().fadeIn()}});$("input[name=shiping_std]").live("click",function(){var h=$(this);$.ajax({url:"/update-expedited-shipping-details/",data:{expedite_shipping_prefs:h.val()},type:"POST",dataType:"json",success:function(j){if(j.err==null){window.location=window.location}else{alert("Something went wrong")}},error:function(j){},complete:function(j){}})})}if(c.fabBase.params.pg=="web_cart_cart_index"){$(".select_v1").change(function(){var k=$(this).val(),h=k.split(":"),j=h[1].split("-"),l=h[0].split("-")[0],n=$("#quantity_select_"+l+" option[value='"+k+"']").text(),m={sale_id:j[0],product_id:j[1],size:j[2],quantity:n,add_or_update_quantity:"update",uniqId:l};c.update_cart_item_quantity(m)});$(".select_v1_cG").change(function(){var h=$(this).val().split(":"),j={cart_product_id:h[0],product_id:h[1],add_or_update:"update",gift_card_id:h[2],uniqId:h[0]};c.update_gift_card_value(j)});$("#scBody .col2").height($("#scBody .col1").height());var e=$("#invoiceBlock");if(e.length>0){var b=0;$(window).scroll(function(h){c.setCartPosition(c.calculateBottomOffset(e),b,e)}).trigger("scroll");$(window).bind("resize",function(){c.setCartPosition(c.calculateBottomOffset(e),b,e)})}}if(d=="web_cart_thank_you"){var f=c.fabBase.params.fb_app_id;var g=c.fabBase.params.fb_access_token_url+"?o_id="+$("#add_to_timeline").data("order-id");$("#add_to_timeline").click(function(){window.open("https://www.facebook.com/dialog/oauth?client_id="+f+"&redirect_uri="+g+"&response_type=code&scope=publish_actions&display=popup","","height=320,width=640")})}$("#proceedToCO").click(function(h){c.proceed_to_checkout()});$(".fabTip").click(function(){var h=$(this);h.parent().parent().find(".tipContent").toggle().find(".greyCross").click(function(){h.parent().parent().find(".tipContent").hide()})});$(".tipContent").hideDomOnClick([".fabTip"])});a.CartBase.method("setCartPosition",function(c,b,d){if(b!=c){d.stop().animate({bottom:c},300,function(){b=c})}});a.CartBase.method("calculateBottomOffset",function(f){var b=$("#scBody"),k=b.height(),d=b.offset(),j=$(window).height(),c=$(window).scrollTop(),g=f.outerHeight(),h=$("#cartOrder").height(),e=Math.max(1,k-(j-d.top+c-1));e=Math.min(e,(h-g));return(e)});a.CartBase.method("listShipBillInfo",function(c){var b=this;$.ajax({url:(c=="ship"?"/shipping-address-list/":"/billing-address-list/"),data:{},type:"GET",dataType:"html",success:function(d){if(d!=""&&c=="ship"){$("#fabModal").modal({content:d,modalSize:"addEditPaymentInfo",onOpen:function(){$("#saveShipInfo").click(function(){b.saveShippingInfo()});$("#addShippingAddress").click(function(){b.addEditShipBillInfo("ship")})},onClose:function(){}})}else{if(d!=""&&c=="bill"){$("#fabModal").modal({content:d,modalSize:"addEditPaymentInfo",onOpen:function(){$("#saveBillInfo").click(function(){b.saveBillingInfo()});$("#addBillingAddress").click(function(){b.addEditShipBillInfo("bill")})},onClose:function(){}})}}},error:function(){}});_gaq.push(["_trackPageview","/"+c+"-address-list/"])});a.CartBase.method("addEditShipBillInfo",function(c){var b=this;if(c=="ship"){$.ajax({url:"/add-shipping-info/",data:{},type:"GET",dataType:"html",success:function(d){if(d!=""){$("#fabModal").modal({content:d,modalSize:"addEditPaymentInfo",onOpen:function(){fabObj.auth().state_ac_init(JSON.parse($("#countries_list").val()));$.switchDefTxt();$("#saveShipInfo").click(function(){b.saveShippingInfo()});$("#ship_address_line1").blur(function(){$address_tag=$("#ship_address_tag");if($address_tag.val()==""){$address_tag.val($(this).val().substr(0,18))}});$(".fabTip").unbind("click").click(function(){var e=$(this);e.parent().parent().find(".tipContent").toggle().find(".greyCross").unbind("click").click(function(){e.parent().parent().find(".tipContent").hide()})});$(".tipContent").hideDomOnClick([".fabTip"])},onClose:function(){}})}},error:function(){}});_gaq.push(["_trackPageview","/edit-shipping-info/"])}else{if(c=="bill"){$("#fabModal").modal({content:"<iframe src='/add-billing-info/' id='btCardLB' name='btCardLB' scrolling='auto' width='780' height='740' onLoad='' frameborder='0' vspace='0' hspace='0' marginwidth='0' marginheight='0'></iframe>",modalSize:"addEditPaymentInfo card",onOpen:function(){$("#fabModalContent").attr("style","*height:800px")},onClose:function(){}});_gaq.push(["_trackPageview","/edit-billing-info/"])}}});a.CartBase.method("changeShippingInfo",function(b){existingAddressInfo=[$(b).attr("ship-addr-id")];$.ajax({url:"/add-shipping-info/",data:{existingAddressInfo:existingAddressInfo},type:"POST",dataType:"json",success:function(c){if(c.err==null){location.reload()}},error:function(){}});_gaq.push(["_trackPageview","/add-shipping-info/"])});a.CartBase.method("saveShippingInfo",function(){if($("#isSelectForm").length==0){var b=this,g="shipLBError",h="",d=false,c={ship_first_name:"First name is required.",ship_last_name:"Last name is required.",ship_address_line1:"Address Line1 is required.",ship_city:"City is required.",ship_state:"State is required.",ship_zip_code:"Zip Code is required.",ship_telephone_no:"Telephone Number is required.",ship_address_tag:"Address Tag is required.",invalid_postal:"Invalid Postal Address"},f=["ship_zip_code","ship_telephone_no"];$(".fabError").removeClass("fabError");$(".errorMsgWrapper").hide();$("#shippingSubmitForm input[type='text'], #shippingSubmitForm select").not("#shippingSubmitForm input[rel='optional']").each(function(k){var j=$(this);if((j.val()=="")||(j.val()!=""&&j.val()==j.attr("title"))){if(j.attr("id")=="cnumber1"||j.attr("id")=="cnumber2"||j.attr("id")=="cnumber3"||j.attr("id")=="cnumber4"){j.addClass("fabError").parent().parent().find(".errorMsgWrapper").show().find(".errorMessage").text(c.card_number)}else{j.addClass("fabError").parent().find(".errorMsgWrapper").show().find(".errorMessage").text(c[j.attr("id")])}d=true}});for(i=0,len=f.length;i<len;i++){var e=$("#"+f[i]).val();if(isNaN(e)&&e!=""&&e!=$("#"+f[i]).attr("title")){$("#"+f[i]).addClass("fabError").parent().find(".errorMsgWrapper").show().find(".errorMessage").text("Expecting Number");d=true}}if($.postalServiceCheck($("#ship_address_line1").val())){$("#ship_address_line1").addClass("fabError").parent().find(".errorMsgWrapper").fadeOut().fadeIn().find(".errorMessage").text(c.invalid_postal);d=true}if($.postalServiceCheck($("#ship_address_line2").val())){$("#ship_address_line2").addClass("fabError").parent().find(".errorMsgWrapper").fadeOut().fadeIn().find(".errorMessage").text(c.invalid_postal);d=true}if($("#ship_zip_code").val()&&$("#ship_zip_code").val().length<5){$("#ship_zip_code").addClass("fabError").parent().find(".errorMsgWrapper").show().find(".errorMessage").text("Invalid Zip Code.");d=true}if($("#ship_telephone_no").val()&&$("#ship_telephone_no").val().length<10){$("#ship_telephone_no").addClass("fabError").parent().find(".errorMsgWrapper").show().find(".errorMessage").text("Invalid Telephone Number.");d=true}if(d){return false}}$.ajax({url:"/add-shipping-info/",data:$("#shippingSubmitForm").serialize(),type:"POST",dataType:"json",success:function(j){if(j.err==null){if(j.reload){window.location=window.location;return}else{$("#showShippingAddress").html(j.shipping_addr).show();$("#addShippingAddress").remove();$("#changeShippingAddress").show();$("#fabModal .closeModal").trigger("click")}}else{if(j.err=="err1"){h="Please provide mandatory values"}else{h="Something went wrong. Please try after some time."}}if(h!=""){fabMsgHandler("errMsg"+g,"error",h)}},error:function(){}});_gaq.push(["_trackPageview","/add-shipping-info/"])});a.CartBase.method("saveBillingInfo",function(){var b=this,c="billLBError",d="";$.ajax({url:"/add-billing-info/",data:$("#shippingSubmitForm").serialize(),type:"POST",dataType:"json",success:function(e){if(e.err==null){window.location=window.location;return}else{if(e.err=="err1"){d="Please provide mandatory values"}else{d="Something went wrong. Please try after some time."}}if(d!=""){fabMsgHandler("errMsg"+c,"error",d)}},error:function(){}});_gaq.push(["_trackPageview","/add-billing-info/"])});a.CartBase.method("update_cart_item_quantity",function(b){$.ajax({url:"/add-to-cart/",data:{cart_product_id:b.uniqId,sale_id:b.sale_id,product_id:b.product_id,size:b.size,quantity:b.quantity,add_or_update_quantity:"update",cart_id:$("#cartId").val()},type:"POST",dataType:"json",success:function(c){var d="";if(c.err==null){location.reload();return}else{if(c.err=="err2"||c.err=="err5"||c.err=="err8"){d="Oops! The product you selected is no longer available. Sorry about that. There's always another design out there.";location.reload();return}else{if(c.err=="err3"||c.err=="err4"||c.err=="err6"){location.reload();return}else{if(c.err=="err9"){d="Oops! The quantity you want to add is no longer available. Please select again."}else{if(c.err=="err7"||c.err=="err12"){d="Oops! Maximum purchase limit reached."}else{d="Something went wrong"}}}}}if(d!=""){fabMsgHandler("errMsg"+b.uniqId,"error",d)}},error:function(){}});_gaq.push(["_trackPageview","/add-to-cart/"])});a.CartBase.method("remove_cart_item",function(e,d,c,h){var g=$("#cartId").val(),b=this,f=h;$.ajax({url:"/remove-cart-item/",data:{cart_id:g,cart_product_id:h,sale_id:e,product_id:d,size:c},type:"POST",dataType:"json",success:function(j){var k="";if(j.err==null){if(j.count==0||$("a").hasClass("confirm_order_remove")){location.reload();return}else{$("#cartOrder").html(j.order);$("#item_"+f).fadeOut("slow",function(){$(this).remove();$("#scBody .col2").height($("#scBody .col1").height())});if(j.count==1){$("#scBody .blankItem").css("height","360px")}$("#proceedToCO").click(function(l){b.proceed_to_checkout()})}}else{if(j.err=="err2"){k="Invalid Cart"}else{if(j.err=="err3"){location.reload();return}else{if(j.err=="err4"){k="This cart has already been checked out."}else{k="Oops! We had trouble removing the item from your cart. Please try again in a minute."}}}}if(k!=""){fabMsgHandler("errMsg"+f,"error",k)}},error:function(){var j="Oops! We had trouble removing the item from your cart. Please try again in a minute.";fabMsgHandler("errMsg"+f,"error",j)}});_gaq.push(["_trackPageview","/remove-cart-item/"])});a.CartBase.method("proceed_to_checkout",function(){var c="",b="CerditAmount";$.ajax({url:"/proceed-to-checkout/",data:{used_credit_amount:$("#used_credit_amount").val(),credit_on_amount:$("#credit_on_amount").val()},type:"POST",dataType:"json",success:function(d){if(d.err==null){window.location=d.rd_to.replace("http://","https://");return}else{if(d.err=="err1"){location.reload();return}else{if(d.err=="err2"){c="Invalid credit amount."}else{if(d.err=="err3"){c="Sorry but you don't have that much credit. Please try again."}else{if(d.err=="err4"){c="Credit can't be more than order subtotal."}else{if(d.err=="err5"){c="Fab E-Gift Cards cannot be purchased with credits."}else{fabMsgHandler("errMsgCart","error","Oops! We had trouble while checkout. Please try again in a minute.")}}}}}}if(c!=""){fabMsgHandler("errMsg"+b,"error",c)}},error:function(){c="Oops! We had trouble while checkout. Please try again in a minute.";fabMsgHandler("errMsgCart","error",c)}});_gaq.push(["_trackPageview","/proceed-to-checkout/"])});a.CartBase.method("update_gift_card_value",function(b){$.ajax({url:"/gift-card/update-cart-value/",data:{cart_product_id:b.cart_product_id,product_id:b.product_id,add_or_update:"update",cart_id:$("#cartId").val(),gift_card_id:b.gift_card_id},type:"POST",dataType:"json",success:function(c){var d="";if(c.err==null||c.err=="err3"||c.err=="err4"||c.err=="err6"){location.reload();return}else{if(c.err=="err13"){d="Sorry, there is already a gift card of this denomination to this person in your cart."}else{d="Something went wrong"}}if(d!=""){fabMsgHandler("errMsg"+b.uniqId,"error",d)}},error:function(){}});_gaq.push(["_trackPageview","/gift-card/update-cart-value/"])});return a})(FabModule);FabModule.CartBase.method("saveShoppingCartGiftDetails",function(){$("#giftSaveCanButton").hide();var c=this,a=$("#giftSavelLoader");a.activity({width:4});if($("#gift_note_true_false").is(":checked")){var b=$("#giftAnOrderCusMsg").val()}else{var b=""}$.ajax({url:"/save-cart-gift-details/",data:{cart_id:$("#cartIdForOrderAsGift").val(),recipient_name:$("#gift_to_whome_first_name").val(),recipient_email:$("#gift_to_whome_email").val(),email_text:$("#giftAnOrderDefMsg").val(),gift_note_text:b,is_checked:$("#gift_note_true_false").is(":checked")},type:"POST",dataType:"json",success:function(d){a.activity(false);if(d.err==null){$("#giftThisOrderSuccessMsg").html("<span class='successMessageIcon fabShopSprite' style='margin-top: 6px;'></span>Your changes have been saved successfully.").css("display","inline-block").fadeOut(3000,function(){if($("#giftAnOrderInnerFrms").hasClass("giftAnOrderInnerFrmsShow")){$("#giftAnOrderInnerFrms").removeClass("giftAnOrderInnerFrmsShow")}else{$("#giftAnOrderInnerFrms").hide()}$(".editSuccess").show();$("#giftOrderToWhom").html($("#gift_to_whome_email").val())})}},complete:function(d){},error:function(d){if(d.err!=null){a.activity(false);$("#giftThisOrderSuccessMsg").html("<span class='fabShopSprite errorMessageIcon' style='margin-top: 6px;'></span>Oops there is some problem please try after sometime.").css("display","inline-block").fadeOut(3000,function(){$("#giftSaveCanButton").show();$("#giftAnOrderInnerFrms").show();$(".editSuccess").hide()})}}})});FabModule.CartBase.method("cancelShoppingCartGiftDetails",function(){var a=this;$("#giftSaveCanButton").hide();var b=$("#giftAnOrderDefMsg"),e=$("#giftAnOrderCusMsg"),g=b.val(),f=e.val();var c=a.giftAnOrderDefMsgDefault,d=a.giftAnOrderCusMsgDefault;$.ajax({url:"/cancel-cart-gift-details/",data:{cart_id:$("#cartIdForOrderAsGift").val()},type:"POST",dataType:"json",success:function(h){if(h.err==null){$(".errorMsgWrapper").hide();$("#gift_to_whome_email, #gift_to_whome_first_name").val("").removeAttr("error").removeClass("fabError");if(g!=c){b.val(c)}if(f!=d){e.val(d)}if($("#gift_note_true_false").is(":checked")){$("#gift_note_true_false").attr("checked",false);$("#giftAnOrderCusMsg").hide();$("#giftAnOrderCusMsgClimit").toggleClass("hide")}$(".editSuccess").hide();if($("#giftAnOrderInnerFrms").hasClass("giftAnOrderInnerFrmsShow")){$("#giftAnOrderInnerFrms").removeClass("giftAnOrderInnerFrmsShow")}else{$("#giftAnOrderInnerFrms").hide()}$("#orderAsGiftYes").show()}},complete:function(h){},error:function(){}})});FabModule.CartBase.method("checkGiftDetails",function(){var b=this,f=$("#gift_to_whome_first_name"),e=$("#gift_to_whome_email"),d=$("#giftAnOrderDefMsg"),c=$("#giftAnOrderCusMsg"),a=$("#gift_note_true_false");Helper.countChar($("#giftAnOrderDefMsg"),$("#charactersDesc"));Helper.countChar($("#giftAnOrderCusMsg"),$("#charactersDescForOrder"));$("#saveCartGiftDetails").click(function(h){var g=f.val(),s=e.val(),n=d.val(),l=c.val();var q=g.replace(/(<([^>]+)>)/ig,""),j=n.replace(/(<([^>]+)>)/ig,"");if(l!=undefined){var k=l.replace(/(<([^>]+)>)/ig,"")}f.val($.trim(q));d.val(j);c.val(k);var m="",p=false,r={gift_to_whome_email:"Please enter your friend's email address.",validEmailAddress:"Please enter a valid email address.",validateGiftNote:"Please enter a your message.",cusValidateGiftNote:"Please enter a your message."},o=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;e.val(s);$(".fabError").removeClass("fabError");$(".errorMsgWrapper").hide();if(!o.test(s)){e.addClass("fabError").parent().find(".errorMsgWrapper").show().find(".errorMessage").text(r.validEmailAddress);return false}if(s==""){e.addClass("fabError").parent().find(".errorMsgWrapper").show().find(".errorMessage").text(r.gift_to_whome_email);return false}if(n==""){d.addClass("fabError").parent().find(".errorMsgWrapper").show().find(".errorMessage").text(r.validateGiftNote);return false}if(a.is(":checked")&&l==""){c.addClass("fabError").parent().find(".errorMsgWrapper").show().find(".errorMessage").text(r.cusValidateGiftNote);return false}if(p){return false}b.saveShoppingCartGiftDetails()})});FabModule.CartBase.method("giftAnOrderModalBox",function(){$("#data-modal-preview-mail").live("click",function(a){a.preventDefault;a.stopPropogation;var b=$("#giftAnOrderDefMsg").val();if(b==""||b==undefined||b=="Type your message here..."){b=""}$.ajax({url:"/preview-gift-mail/",data:{sender_fname:$("#senderFirstName").val(),sender_lname:$("#senderLastName").val(),email_text:b,gift_note_text:$("#giftAnOrderCusMsg").val()},type:"POST",dataType:"json",success:function(c){if(c.err==null){$("#fabModal").modal({content:c.lb_content,modalSize:"previewMailContent",onOpen:function(){}})}else{}},error:function(){}})})});function afterBillSaveSuccess(){$("#addBillingAddress").remove();$("#fabModal .closeModal").trigger("click");window.location=window.location.href.split("?")[0]};